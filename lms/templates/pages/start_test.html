{% extends "templates/web.html" %} {% from "erpnext/templates/includes/macros.html" import product_image_square %} {% block page_content %}
<input type="hidden" id="UserInfoId" value="{{userlog}}">
<input type="hidden" id="IsPublicResult" value="{{PublishResult}}">
<input type="hidden" id="ExamId" value="{{ExamId}}">
<input type="hidden" id="scholarship" value= "{{frappe.db.get_value("Exam", ExamId, "scholarship") }}"">

<div class="row">
    <div class="headerRow">
        <div class="timeLeft">
            <span class="timetitle">Time Left</span>
            <div id="CountDownTimer" data-timer="{{Duration*60}}" style="min-height: 65px;/* border: 1px solid #d3d3d3; */background: white;float:left;width: auto;margin-top: -15px;">
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-9" id="MainContent">
        {% if questions %}
        <div class='featured-products-section' itemscope itemtype="http://schema.org/Product">
            <div>
                <div id="search-list" class="row" >
                    {% for item in questions %} {% set i=loop.index %} {% set showStyle="display:none" %} {% if i==1 %} {% set showStyle="display:block" %} {% endif %}
                    <div class="col-sm-12 col-xs-12 product-image-wrapper QuestionItem" secured-marks="{{item[3]}}" data-type="{{item[2]}}" id="QuestionItem-{{i}}" data-name="{{item[0]}}" data-chapter="{{item[4]}}" style="{{showStyle}}">
                        <div>
                            <div class="QuestionNo" itemprop="name">Question No : {{i}}</div>
                            <div class="QuestionTitle" itemprop="name">{{ item[1] }}</div>
                            {% if item[2]=="Single Option" %}
                            <div class="options">
                                {% for optionitem in Answers %} {% if optionitem.parent==item[0] %}
                                <label class="optionItem">
                                    <input type="radio" data-correct="{{optionitem.is_correct}}" data-name="{{optionitem.name}}" value="{{optionitem.options}}" style="margin-right:10px;transform: scale(1.35);margin-top: 4px;float: left;" name="rdOption-{{i}}" /><span>{{optionitem.options}}</span>
                                </label>
                                {% endif %} {% endfor %}
                            </div>
                            {% endif %} {% if item[2]=="Multi Option" %}
                            <div class="options">
                                {% for optionitem in Answers %} {% if optionitem.parent==item[0] %}
                                <label class="optionItem">
                                    <input type="checkbox" value="{{optionitem.options}}" data-name="{{optionitem.name}}" data-correct="{{optionitem.is_correct}}" style="margin-right:10px;transform: scale(1.35);margin-top: 4px;float: left;" name="rdOption-{{i}}" /><span>{{optionitem.options}}</span>
                                </label>
                                {% endif %} {% endfor %}
                            </div>
                            {% endif %}
                            <div class="buttons">
                                <a class="btn btn-primary action-btn" onclick="goNext({{i+1}})">Save</a>
                                <a class="btn btn-primary action-btn" onclick="ReviewLater({{i}})" style="
    background: #fff;
    color: #000;
    font-weight: 600;
">Review Later</a>
                                <a class="btn btn-primary action-btn" onclick="CancelSelection({{i}})" style="
    background: #fff;
    color: #000;
    font-weight: 600;
">Cancel Selection</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="col-sm-3" id="rightContent">
        <div class="QuestionsOverView">
            <span class="timetitle" style="
    font-size: 17px;
    padding-left: 0;
    margin-bottom: 10px;
">Questions Overview</span>
            <div class="tblQuestions">
                {% for item in questions %} {% set firstQuestion="" %} {% if loop.index==1 %} {% set firstQuestion="selectedClass" %} {% endif %}
                <a style="cursor:pointer;" class="rightQuestion col-md-3 col-sm-6 col-xs-3" data-toggle="tooltip" title="{{item.name}}" onclick="selectQuestion({{loop.index}})"><span id="questionNo-{{loop.index}}" class="questionNo {{firstQuestion}}">{{loop.index}}</span></a> {% endfor %}
            </div>
            <div id="legendDiv" style="float:left;width:100%;">
                <div class="legend-item">
                    <div class="attened legenditem"></div>Attempted</div>
                <div class="legend-item">
                    <div class="notattened legenditem"></div>Not Attempted</div>
                <div class="legend-item">
                    <div class="review legenditem"></div>Review Later</div>
                <div class="legend-item">
                    <div class="notviewed legenditem"></div>Not viewed yet</div>
                <div class="legend-item" style="width: 100%;">
                    <div class="review legenditem" style="text-align: center;">
                        <i class="fa fa-check" style="color: #fff;">
                        </i></div>Attempted and Marked for review</div>
            </div>
        </div>
        <button class="btn btn-primary btn-finish" onclick="finish()">Finish</button>
    </div>
</div>
<div class="Loading">Loading...</div>
{% endblock %} {% block style %}
<style>
.Loading
{
        position: fixed;
    top: 0;
    z-index: 999999999999999999999;
    width: 100%;
    height: 100%;
    background: #000;
    left: 0;
    opacity: 0.5;
    color: #fff;
    font-size: 22px;
    padding-left: 45%;
    padding-top: 23%;
    display: none;
}
.QuestionNo {
    float: left;
    width: 100%;
    border-bottom: 1px solid #5e64ff;
    padding-bottom: 10px;
    font-size: 18px;
    color: #000;
    font-weight: 600;
    margin-bottom: 25px;
}

.action-btn {
    border-radius: 2px !important;
    margin: 8px;
    text-align: center;
    width: 181px;
    font-weight: 600;
    border-radius: 2px;
    display: inline-block;
    padding: 8px;
    cursor: pointer;
    font-size: 18px;
}

.review {
    background: purple;
    border: none;
}

.QuestionsOverView {
    padding: 10px;

    height: calc( 100% - 182px);
    margin-top: 0px;
}

.headerRow {
    float: left;
    width: 100%;
    background: #fff;
    padding-top: 8px;
    /* text-align: right; */
    border-bottom: 1px solid #d3d3d3;
    margin-bottom: 20px;
    height: 50px;
    position: fixed;
    z-index: 999999999999999999999999999999;
}

.legend-title {
    float: left;
    width: 100%;
    font-weight: 600;
    color: #000;
}

.legend-item {
    float: left;
    width: 50%;
    margin-top: 10px;
    font-size: 15px;
}

.legenditem {

    float: left;
    width: 25px;
    border: 1px solid #d3d3d3;
    height: 25px;
    margin-right: 10px;
    margin-bottom: 10px;
}

#legendDiv {

    float: left;
    width: 100%;

    border-top: none;
    padding-top: 10px;
    padding-bottom: 10px;
}

.tblQuestions {

    float: left;
    width: 100%;


    padding-bottom: 10px;
    height: 60%;
    overflow-y: auto;
}

.questionNo {
    float: left;
    background: #fff;
    padding: 8px 5px;
    border-radius: 5px;
    width: 100%;
    border: 1px solid #d3d3d3;
    font-size: 15px;
    margin-bottom: 15px;
    text-align: center;
}

.rightQuestion {
    float: left;
    font-size: 12px;
    text-align: justify;
}

.answeredClass {
    background: #55a417;
    color: #fff;
    border: none;
}

.selectedClass {
    background: #f22133;
    color: white;
    border: none;
}

.timetitle {

    color: #000;
    padding: 5px;
    float: left;
    width: auto;
    /* border: 1px solid #d3d3d3; */
    text-align: left;
    font-weight: 600;
    border-bottom: none;
    padding-left: 10px;
}

.page_content {
    padding-top: 0px !important;
}

.buttons {
    float: left;
    width: 100%;
    margin-top: 15px;
    position: fixed;
    bottom: 0;
    left: 0;
    padding: 15px;
    border-top: 1px solid #d3d3d3;
    transform: translate(-12%);
    -webkit-transform: translate(-12%);
    text-align: center;
    background: #fff;
}

.QuestionItem {
    float: left;
    width: 100%;
}

.QuestionTitle {
    float: left;
    width: calc(100%);
    font-size: 17px;
    /*background: #f5f5f5;*/
    margin-top: -15px;
    padding: 10px 0px;
    /*border: 1px solid #d3d3d3;*/
    line-height: 30px;
}

.optionItem {
    float: left;
    width: calc(100%);
    margin-bottom: 10px;
    padding-left: 15px;
    /* border: 1px solid #d3d3d3;*/
    padding-bottom: 15px;
    /* background: #f6f6f6; */
    padding-top: 15px;
    max-width: calc(100% + 30px);
    font-weight: normal;
    cursor: pointer;
    margin-top: 15px;
    font-size: 16px;
}

.hero {
    padding-top: 50px;
    padding-bottom: 100px;
}

.hero h1 {
    font-size: 40px;
    font-weight: 200;
}

.home-login {
    margin-top: 30px;
}

.btn-login {
    width: 80px;
}

.featured-product-heading,
.all-products {
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 12px;
    font-weight: 500;
}

.all-products {
    font-weight: 300;
    padding-left: 25px;
    padding-right: 25px;
    padding-top: 10px;
    padding-bottom: 10px;
}




/**
 *  This element is created inside your target element
 *  It is used so that your own element will not need to be altered
 **/

.time_circles {
    position: relative;
    width: 100%;
    height: 100%;
}




/**
 *  This is all the elements used to house all text used
 * in time circles
 **/

.time_circles>div {
    position: absolute;
    text-align: center;
    width: 45px !important;
}




/**
 *  Titles (Days, Hours, etc)
 **/

.time_circles>div>h4 {
    margin: 0px;
    padding: 0px;
    text-align: center;
    text-transform: uppercase;
    font-family: 'Century Gothic', Arial;
    font-size: 9px !important;
    color: #000;
    font-weight: bold;
    position: absolute;
    bottom: -35px;
    text-align: center;
    width: 100%;
    display: none;
}

.page-content.without-sidebar {
    padding-top: 0;
}

.page-head {
    margin-bottom: -30px;
    display: none;
    height: 0;
}

.textDiv_Seconds {
    left: 90px !important;
}

.textDiv_Minutes {
    left: 40px !important;
}

.textDiv_Hours span:after {
    content: ":";
    position: absolute;
    right: 0;
}

.textDiv_Minutes span:after {
    content: ":";
    position: absolute;
    right: 0;
}




/**
 *  Time numbers, ie: 12
 **/

.time_circles>div>span {
    display: block;
    width: 100%;
    text-align: center;
    font-family: 'Century Gothic', Arial;
    font-size: 300%;
    margin-top: -5px;
    font-weight: bold;
}

.resultHeader {
    float: left;
    width: 100%;
    border: 1px solid #d3d3d3;
    padding: 15px;
}

.headerTitle {
    margin-bottom: 15px;
    margin-top: 10px;
    font-weight: 500;
}

.resultHeaderTitle {
    text-align: center;
    margin-top: 0;
    float: left;
    width: calc(100% + 30px);
    margin-left: -15px;
    border-bottom: 1px solid #d3d3d3;
    padding-bottom: 15px;
    font-weight: 500;
}

@media only screen and (max-width: 767px) {
    #MainContent {
        position: absolute;
        top: 525px;
    }
    #rightContent {
        position: absolute;
        top: 80px;
    }
}

.container {
        width: 100% !important;
    padding: 0;
}

.page-container {
    max-width: 100% !important;
}

header {
    display: none;
}

canvas {
    display: none;
}

#freeapplication{
    margin-bottom: 1%;
}

.timeLeft {
    position: absolute;
}

.btn-finish {

    position: fixed;
    top: 8px;
    z-index: 99999999999;
    right: 10px;
}

@media only screen and (min-width: 968px) {
    .timeLeft {
        right: 10%;
    }
    #rightContent {

        background: #f5f5f5;
        height: 100%;
        margin-top: -20px;
        position: fixed;
        right: 0;
        padding-top: 0px;
        border-left: 1px solid #d3d3d3;
        top: 70px;
    }
    #MainContent {
        margin-top: 70px;
    }
    .btn-finish {
        position: fixed;
        width: 23%;
        bottom: 10px;
        font-size: 18px;
        padding-top: 10px;
        padding-bottom: 10px;

        top: auto;
    }
}

.attened {
    border: none;
    background: #55a417;
}

.notattened {
    border: none;
    background: #f22133;
}

.notviewed {

    background: #fff;
}

.optionItem:hover {
    background: #f5f5f5;
}

.optionItem.active {
    background: rgba(154, 220, 244, 0.4);
}

.ReviewedLaterClass {
    background: purple;
    color: #fff;
    border: none;
}

.ReviewedLaterAnsweredClass {
    background: purple;
    color: #fff;
    border: none;
}
.resultSpan
{
        font-size: 18px;
    /* position: absolute; */
    /* top: 30%; */
    float: left;
    margin-top: 25%;
    width: 100%;
    text-align: center;
}
@media (max-width: 1023px) {
    .action-btn {
        width: 30%;
        float: left;
        margin: 8px 0;
        padding: 5px;
        font-size: 11px;
        margin-left: 2%;
    }
    .buttons {
        transform: inherit;
        -webkit-transform: inherit;
        padding: 5px;
    }
}

@media (max-width: 1023px) {
    .legend-item {
        width: 100%;
    }
}
.page-content-wrapper
{
    background: #fff !important;
        padding: 0 !important;
    float: none !important;
    margin-top: 0 !important;
}
.col-md-12
{
    padding: 0 15px !important;
}
</style>
{% endblock %} {% block script %}
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({ extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "a11y/accessibility-menu.js"], "HTML-CSS": {imageFont: null }, showMathMenu: false, showMathMenuMSIE: false, TeX: { extensions: ["AMSmath.js","AMSsymbols.js","noUndefined.js"]}, jax: ["input/TeX","input/AsciiMath","output/HTML-CSS"] });
</script>
<script type="text/javascript">
    var currentDate=new Date();
    var startTime=currentDate.getHours()+":"+currentDate.getMinutes()+":"+currentDate.getSeconds();
    console.log(startTime);
/**
 * Basic structure: TC_Class is the public class that is returned upon being called
 * 
 * So, if you do
 *      var tc = $(".timer").TimeCircles();
 *      
 * tc will contain an instance of the public TimeCircles class. It is important to
 * note that TimeCircles is not chained in the conventional way, check the
 * documentation for more info on how TimeCircles can be chained.
 * 
 * After being called/created, the public TimerCircles class will then- for each element
 * within it's collection, either fetch or create an instance of the private class.
 * Each function called upon the public class will be forwarded to each instance
 * of the private classes within the relevant element collection
 **/
/*
 *  /MathJax/extensions/MathMenu.js
 *
 *  Copyright (c) 2009-2017 The MathJax Consortium
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

(function($) {

    var useWindow = window;

    // From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys
    if (!Object.keys) {
        Object.keys = (function() {
            'use strict';
            var hasOwnProperty = Object.prototype.hasOwnProperty,
                hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),
                dontEnums = [
                    'toString',
                    'toLocaleString',
                    'valueOf',
                    'hasOwnProperty',
                    'isPrototypeOf',
                    'propertyIsEnumerable',
                    'constructor'
                ],
                dontEnumsLength = dontEnums.length;

            return function(obj) {
                if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {
                    throw new TypeError('Object.keys called on non-object');
                }

                var result = [],
                    prop, i;

                for (prop in obj) {
                    if (hasOwnProperty.call(obj, prop)) {
                        result.push(prop);
                    }
                }

                if (hasDontEnumBug) {
                    for (i = 0; i < dontEnumsLength; i++) {
                        if (hasOwnProperty.call(obj, dontEnums[i])) {
                            result.push(dontEnums[i]);
                        }
                    }
                }
                return result;
            };
        }());
    }

    // Used to disable some features on IE8
    var limited_mode = false;
    var tick_duration = 200; // in ms

    var debug = (location.hash === "#debug");

    function debug_log(msg) {
        if (debug) {
            console.log(msg);
        }
    }

    var allUnits = ["Days", "Hours", "Minutes", "Seconds"];
    var nextUnits = {
        Seconds: "Minutes",
        Minutes: "Hours",
        Hours: "Days",
        Days: "Years"
    };
    var secondsIn = {
        Seconds: 1,
        Minutes: 60,
        Hours: 3600,
        Days: 86400,
        Months: 2678400,
        Years: 31536000
    };

    /**
     * Converts hex color code into object containing integer values for the r,g,b use
     * This function (hexToRgb) originates from:
     * http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb
     * @param {string} hex color code
     */
    function hexToRgb(hex) {

        // Verify already RGB (e.g. "rgb(0,0,0)") or RGBA (e.g. "rgba(0,0,0,0.5)")
        var rgba = /^rgba?\(([\d]+),([\d]+),([\d]+)(,([\d\.]+))?\)$/;
        if (rgba.test(hex)) {
            var result = rgba.exec(hex);
            return {
                r: parseInt(result[1]),
                g: parseInt(result[2]),
                b: parseInt(result[3]),
                a: parseInt(result[5] ? result[5] : 1)
            };
        }

        // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
        var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
        hex = hex.replace(shorthandRegex, function(m, r, g, b) {
            return r + r + g + g + b + b;
        });

        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }

    function isCanvasSupported() {
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }

    /**
     * Function s4() and guid() originate from:
     * http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript
     */
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }

    /**
     * Creates a unique id
     * @returns {String}
     */
    function guid() {
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
            s4() + '-' + s4() + s4() + s4();
    }

    /**
     * Array.prototype.indexOf fallback for IE8
     * @param {Mixed} mixed
     * @returns {Number}
     */
    if (!Array.prototype.indexOf) {
        Array.prototype.indexOf = function(elt /*, from*/ ) {
            var len = this.length >>> 0;

            var from = Number(arguments[1]) || 0;
            from = (from < 0) ?
                Math.ceil(from) :
                Math.floor(from);
            if (from < 0)
                from += len;

            for (; from < len; from++) {
                if (from in this &&
                    this[from] === elt)
                    return from;
            }
            return -1;
        };
    }

    function parse_date(str) {
        var match = str.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}\s[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/);
        if (match !== null && match.length > 0) {
            var parts = str.split(" ");
            var date = parts[0].split("-");
            var time = parts[1].split(":");
            return new Date(date[0], date[1] - 1, date[2], time[0], time[1], time[2]);
        }
        // Fallback for different date formats
        var d = Date.parse(str);
        if (!isNaN(d))
            return d;
        d = Date.parse(str.replace(/-/g, '/').replace('T', ' '));
        if (!isNaN(d))
            return d;
        // Cant find anything
        return new Date();
    }

    function parse_times(diff, old_diff, total_duration, units, floor) {
        var raw_time = {};
        var raw_old_time = {};
        var time = {};
        var pct = {};
        var old_pct = {};
        var old_time = {};

        var greater_unit = null;
        for (var i = 0; i < units.length; i++) {
            var unit = units[i];
            var maxUnits;

            if (greater_unit === null) {
                maxUnits = total_duration / secondsIn[unit];
            } else {
                maxUnits = secondsIn[greater_unit] / secondsIn[unit];
            }

            var curUnits = (diff / secondsIn[unit]);
            var oldUnits = (old_diff / secondsIn[unit]);

            if (floor) {
                if (curUnits > 0) curUnits = Math.floor(curUnits);
                else curUnits = Math.ceil(curUnits);
                if (oldUnits > 0) oldUnits = Math.floor(oldUnits);
                else oldUnits = Math.ceil(oldUnits);
            }

            if (unit !== "Days") {
                curUnits = curUnits % maxUnits;
                oldUnits = oldUnits % maxUnits;
            }

            raw_time[unit] = curUnits;
            time[unit] = Math.abs(curUnits);
            raw_old_time[unit] = oldUnits;
            old_time[unit] = Math.abs(oldUnits);
            pct[unit] = Math.abs(curUnits) / maxUnits;
            old_pct[unit] = Math.abs(oldUnits) / maxUnits;

            greater_unit = unit;
        }

        return {
            raw_time: raw_time,
            raw_old_time: raw_old_time,
            time: time,
            old_time: old_time,
            pct: pct,
            old_pct: old_pct
        };
    }

    var TC_Instance_List = {};

    function updateUsedWindow() {
        if (typeof useWindow.TC_Instance_List !== "undefined") {
            TC_Instance_List = useWindow.TC_Instance_List;
        } else {
            useWindow.TC_Instance_List = TC_Instance_List;
        }
        initializeAnimationFrameHandler(useWindow);
    };

    function initializeAnimationFrameHandler(w) {
        var vendors = ['webkit', 'moz'];
        for (var x = 0; x < vendors.length && !w.requestAnimationFrame; ++x) {
            w.requestAnimationFrame = w[vendors[x] + 'RequestAnimationFrame'];
            w.cancelAnimationFrame = w[vendors[x] + 'CancelAnimationFrame'];
        }

        if (!w.requestAnimationFrame || !w.cancelAnimationFrame) {
            w.requestAnimationFrame = function(callback, element, instance) {
                if (typeof instance === "undefined")
                    instance = { data: { last_frame: 0 } };
                var currTime = new Date().getTime();
                var timeToCall = Math.max(0, 16 - (currTime - instance.data.last_frame));
                var id = w.setTimeout(function() {
                    callback(currTime + timeToCall);
                }, timeToCall);
                instance.data.last_frame = currTime + timeToCall;
                return id;
            };
            w.cancelAnimationFrame = function(id) {
                clearTimeout(id);
            };
        }
    };


    var TC_Instance = function(element, options) {
        this.element = element;
        this.container;
        this.listeners = null;
        this.data = {
            paused: false,
            last_frame: 0,
            animation_frame: null,
            interval_fallback: null,
            timer: false,
            total_duration: null,
            prev_time: null,
            drawn_units: [],
            text_elements: {
                Days: null,
                Hours: null,
                Minutes: null,
                Seconds: null
            },
            attributes: {
                canvas: null,
                context: null,
                item_size: null,
                line_width: null,
                radius: null,
                outer_radius: null
            },
            state: {
                fading: {
                    Days: false,
                    Hours: false,
                    Minutes: false,
                    Seconds: false
                }
            }
        };

        this.config = null;
        this.setOptions(options);
        this.initialize();
    };

    TC_Instance.prototype.clearListeners = function() {
        this.listeners = { all: [], visible: [] };
    };

    TC_Instance.prototype.addTime = function(seconds_to_add) {
        if (this.data.attributes.ref_date instanceof Date) {
            var d = this.data.attributes.ref_date;
            d.setSeconds(d.getSeconds() + seconds_to_add);
        } else if (!isNaN(this.data.attributes.ref_date)) {
            this.data.attributes.ref_date += (seconds_to_add * 1000);
        }
    };

    TC_Instance.prototype.initialize = function(clear_listeners) {
        // Initialize drawn units
        this.data.drawn_units = [];
        for (var i = 0; i < Object.keys(this.config.time).length; i++) {
            var unit = Object.keys(this.config.time)[i];
            if (this.config.time[unit].show) {
                this.data.drawn_units.push(unit);
            }
        }

        // Avoid stacking
        $(this.element).children('div.time_circles').remove();

        if (typeof clear_listeners === "undefined")
            clear_listeners = true;
        if (clear_listeners || this.listeners === null) {
            this.clearListeners();
        }
        this.container = $("<div>");
        this.container.addClass('time_circles');
        this.container.appendTo(this.element);

        // Determine the needed width and height of TimeCircles
        var height = this.element.offsetHeight;
        var width = this.element.offsetWidth;
        if (height === 0)
            height = $(this.element).height();
        if (width === 0)
            width = $(this.element).width();

        if (height === 0 && width > 0)
            height = width / this.data.drawn_units.length;
        else if (width === 0 && height > 0)
            width = height * this.data.drawn_units.length;

        // Create our canvas and set it to the appropriate size
        var canvasElement = document.createElement('canvas');
        canvasElement.width = width;
        canvasElement.height = height;

        // Add canvas elements
        this.data.attributes.canvas = $(canvasElement);
        this.data.attributes.canvas.appendTo(this.container);

        // Check if the browser has browser support
        var canvasSupported = isCanvasSupported();
        // If the browser doesn't have browser support, check if explorer canvas is loaded
        // (A javascript library that adds canvas support to browsers that don't have it)
        if (!canvasSupported && typeof G_vmlCanvasManager !== "undefined") {
            G_vmlCanvasManager.initElement(canvasElement);
            limited_mode = true;
            canvasSupported = true;
        }
        if (canvasSupported) {
            this.data.attributes.context = canvasElement.getContext('2d');
        }

        this.data.attributes.item_size = Math.min(width / this.data.drawn_units.length, height);
        this.data.attributes.line_width = this.data.attributes.item_size * this.config.fg_width;
        this.data.attributes.radius = ((this.data.attributes.item_size * 0.8) - this.data.attributes.line_width) / 2;
        this.data.attributes.outer_radius = this.data.attributes.radius + 0.5 * Math.max(this.data.attributes.line_width, this.data.attributes.line_width * this.config.bg_width);

        // Prepare Time Elements
        var i = 0;
        for (var key in this.data.text_elements) {
            if (!this.config.time[key].show)
                continue;

            var textElement = $("<div>");
            textElement.addClass('textDiv_' + key);
            textElement.css("top", Math.round(0.35 * this.data.attributes.item_size));
            textElement.css("left", Math.round(i++ * this.data.attributes.item_size));
            textElement.css("width", this.data.attributes.item_size);
            textElement.appendTo(this.container);

            var headerElement = $("<h4>");
            headerElement.text(this.config.time[key].text); // Options
            headerElement.css("font-size", Math.round(this.config.text_size * this.data.attributes.item_size));
            headerElement.appendTo(textElement);

            var numberElement = $("<span>");
            numberElement.css("font-size", Math.round(this.config.number_size * this.data.attributes.item_size));
            numberElement.appendTo(textElement);

            this.data.text_elements[key] = numberElement;
        }

        this.start();
        if (!this.config.start) {
            this.data.paused = true;
        }

        // Set up interval fallback
        var _this = this;
        this.data.interval_fallback = useWindow.setInterval(function() {
            _this.update.call(_this, true);
        }, 100);
    };

    TC_Instance.prototype.update = function(nodraw) {
        if (typeof nodraw === "undefined") {
            nodraw = false;
        } else if (nodraw && this.data.paused) {
            return;
        }

        if (limited_mode) {
            //Per unit clearing doesn't work in IE8 using explorer canvas, so do it in one time. The downside is that radial fade cant be used
            this.data.attributes.context.clearRect(0, 0, this.data.attributes.canvas[0].width, this.data.attributes.canvas[0].hright);
        }
        var diff, old_diff;

        var prevDate = this.data.prev_time;
        var curDate = new Date();
        this.data.prev_time = curDate;

        if (prevDate === null)
            prevDate = curDate;

        // If not counting past zero, and time < 0, then simply draw the zero point once, and call stop
        if (!this.config.count_past_zero) {
            if (curDate > this.data.attributes.ref_date) {
                for (var i = 0; i < this.data.drawn_units.length; i++) {
                    var key = this.data.drawn_units[i];

                    // Set the text value
                    this.data.text_elements[key].text("0");
                    var x = (i * this.data.attributes.item_size) + (this.data.attributes.item_size / 2);
                    var y = this.data.attributes.item_size / 2;
                    var color = this.config.time[key].color;
                    this.drawArc(x, y, color, 0);
                }
                this.stop();
                return;
            }
        }

        // Compare current time with reference
        diff = (this.data.attributes.ref_date - curDate) / 1000;
        old_diff = (this.data.attributes.ref_date - prevDate) / 1000;

        var floor = this.config.animation !== "smooth";

        var visible_times = parse_times(diff, old_diff, this.data.total_duration, this.data.drawn_units, floor);
        var all_times = parse_times(diff, old_diff, secondsIn["Years"], allUnits, floor);

        var i = 0;
        var j = 0;
        var lastKey = null;

        var cur_shown = this.data.drawn_units.slice();
        for (var i in allUnits) {
            var key = allUnits[i];

            // Notify (all) listeners
            if (Math.floor(all_times.raw_time[key]) !== Math.floor(all_times.raw_old_time[key])) {
                this.notifyListeners(key, Math.floor(all_times.time[key]), Math.floor(diff), "all");
            }

            if (cur_shown.indexOf(key) < 0)
                continue;

            // Notify (visible) listeners
            if (Math.floor(visible_times.raw_time[key]) !== Math.floor(visible_times.raw_old_time[key])) {
                this.notifyListeners(key, Math.floor(visible_times.time[key]), Math.floor(diff), "visible");
            }

            if (!nodraw) {
                // Set the text value
                this.data.text_elements[key].text(Math.floor(Math.abs(visible_times.time[key])));

                var x = (j * this.data.attributes.item_size) + (this.data.attributes.item_size / 2);
                var y = this.data.attributes.item_size / 2;
                var color = this.config.time[key].color;

                if (this.config.animation === "smooth") {
                    if (lastKey !== null && !limited_mode) {
                        if (Math.floor(visible_times.time[lastKey]) > Math.floor(visible_times.old_time[lastKey])) {
                            this.radialFade(x, y, color, 1, key);
                            this.data.state.fading[key] = true;
                        } else if (Math.floor(visible_times.time[lastKey]) < Math.floor(visible_times.old_time[lastKey])) {
                            this.radialFade(x, y, color, 0, key);
                            this.data.state.fading[key] = true;
                        }
                    }
                    if (!this.data.state.fading[key]) {
                        this.drawArc(x, y, color, visible_times.pct[key]);
                    }
                } else {
                    this.animateArc(x, y, color, visible_times.pct[key], visible_times.old_pct[key], (new Date()).getTime() + tick_duration);
                }
            }
            lastKey = key;
            j++;
        }

        // Dont request another update if we should be paused
        if (this.data.paused || nodraw) {
            return;
        }

        // We need this for our next frame either way
        var _this = this;
        var update = function() {
            _this.update.call(_this);
        };

        // Either call next update immediately, or in a second
        if (this.config.animation === "smooth") {
            // Smooth animation, Queue up the next frame
            this.data.animation_frame = useWindow.requestAnimationFrame(update, _this.element, _this);
        } else {
            // Tick animation, Don't queue until very slightly after the next second happens
            var delay = (diff % 1) * 1000;
            if (delay < 0)
                delay = 1000 + delay;
            delay += 50;

            _this.data.animation_frame = useWindow.setTimeout(function() {
                _this.data.animation_frame = useWindow.requestAnimationFrame(update, _this.element, _this);
            }, delay);
        }
    };

    TC_Instance.prototype.animateArc = function(x, y, color, target_pct, cur_pct, animation_end) {
        if (this.data.attributes.context === null)
            return;

        var diff = cur_pct - target_pct;
        if (Math.abs(diff) > 0.5) {
            if (target_pct === 0) {
                this.radialFade(x, y, color, 1);
            } else {
                this.radialFade(x, y, color, 0);
            }
        } else {
            var progress = (tick_duration - (animation_end - (new Date()).getTime())) / tick_duration;
            if (progress > 1)
                progress = 1;

            var pct = (cur_pct * (1 - progress)) + (target_pct * progress);
            this.drawArc(x, y, color, pct);

            //var show_pct =
            if (progress >= 1)
                return;
            var _this = this;
            useWindow.requestAnimationFrame(function() {
                _this.animateArc(x, y, color, target_pct, cur_pct, animation_end);
            }, this.element);
        }
    };

    TC_Instance.prototype.drawArc = function(x, y, color, pct) {
        if (this.data.attributes.context === null)
            return;

        var clear_radius = Math.max(this.data.attributes.outer_radius, this.data.attributes.item_size / 2);
        if (!limited_mode) {
            this.data.attributes.context.clearRect(
                x - clear_radius,
                y - clear_radius,
                clear_radius * 2,
                clear_radius * 2
            );
        }

        if (this.config.use_background) {
            this.data.attributes.context.beginPath();
            this.data.attributes.context.arc(x, y, this.data.attributes.radius, 0, 2 * Math.PI, false);
            this.data.attributes.context.lineWidth = this.data.attributes.line_width * this.config.bg_width;

            // line color
            this.data.attributes.context.strokeStyle = this.config.circle_bg_color;
            this.data.attributes.context.stroke();
        }

        // Direction
        var startAngle, endAngle, counterClockwise;
        var defaultOffset = (-0.5 * Math.PI);
        var fullCircle = 2 * Math.PI;
        startAngle = defaultOffset + (this.config.start_angle / 360 * fullCircle);
        var offset = (2 * pct * Math.PI);

        if (this.config.direction === "Both") {
            counterClockwise = false;
            startAngle -= (offset / 2);
            endAngle = startAngle + offset;
        } else {
            if (this.config.direction === "Clockwise") {
                counterClockwise = false;
                endAngle = startAngle + offset;
            } else {
                counterClockwise = true;
                endAngle = startAngle - offset;
            }
        }

        this.data.attributes.context.beginPath();
        this.data.attributes.context.arc(x, y, this.data.attributes.radius, startAngle, endAngle, counterClockwise);
        this.data.attributes.context.lineWidth = this.data.attributes.line_width;

        // line color
        this.data.attributes.context.strokeStyle = color;
        this.data.attributes.context.stroke();
    };

    TC_Instance.prototype.radialFade = function(x, y, color, from, key) {
        // TODO: Make fade_time option
        var rgb = hexToRgb(color);
        var _this = this; // We have a few inner scopes here that will need access to our instance

        var step = 0.2 * ((from === 1) ? -1 : 1);
        var i;
        for (i = 0; from <= 1 && from >= 0; i++) {
            // Create inner scope so our variables are not changed by the time the Timeout triggers
            (function() {
                var delay = 50 * i;
                var rgba = "rgba(" + rgb.r + ", " + rgb.g + ", " + rgb.b + ", " + (Math.round(from * 10) / 10) + ")";
                useWindow.setTimeout(function() {
                    _this.drawArc(x, y, rgba, 1);
                }, delay);
            }());
            from += step;
        }
        if (typeof key !== undefined) {
            useWindow.setTimeout(function() {
                _this.data.state.fading[key] = false;
            }, 50 * i);
        }
    };

    TC_Instance.prototype.timeLeft = function() {
        if (this.data.paused && typeof this.data.timer === "number") {
            return this.data.timer;
        }
        var now = new Date();
        return ((this.data.attributes.ref_date - now) / 1000);
    };

    TC_Instance.prototype.start = function() {
        useWindow.cancelAnimationFrame(this.data.animation_frame);
        useWindow.clearTimeout(this.data.animation_frame)

        // Check if a date was passed in html attribute or jquery data
        var attr_data_date = $(this.element).data('date');
        if (typeof attr_data_date === "undefined") {
            attr_data_date = $(this.element).attr('data-date');
        }
        if (typeof attr_data_date === "string") {
            this.data.attributes.ref_date = parse_date(attr_data_date);
        }
        // Check if this is an unpause of a timer
        else if (typeof this.data.timer === "number") {
            if (this.data.paused) {
                this.data.attributes.ref_date = (new Date()).getTime() + (this.data.timer * 1000);
            }
        } else {
            // Try to get data-timer
            var attr_data_timer = $(this.element).data('timer');
            if (typeof attr_data_timer === "undefined") {
                attr_data_timer = $(this.element).attr('data-timer');
            }
            if (typeof attr_data_timer === "string") {
                attr_data_timer = parseFloat(attr_data_timer);
            }
            if (typeof attr_data_timer === "number") {
                this.data.timer = attr_data_timer;
                this.data.attributes.ref_date = (new Date()).getTime() + (attr_data_timer * 1000);
            } else {
                // data-timer and data-date were both not set
                // use config date
                this.data.attributes.ref_date = this.config.ref_date;
            }
        }

        // Start running
        this.data.paused = false;
        this.update.call(this);
    };

    TC_Instance.prototype.restart = function() {
        this.data.timer = false;
        this.start();
    };

    TC_Instance.prototype.stop = function() {
        if (typeof this.data.timer === "number") {
            this.data.timer = this.timeLeft(this);
        }
        // Stop running
        this.data.paused = true;
        useWindow.cancelAnimationFrame(this.data.animation_frame);
    };

    TC_Instance.prototype.destroy = function() {
        this.clearListeners();
        this.stop();
        useWindow.clearInterval(this.data.interval_fallback);
        this.data.interval_fallback = null;

        this.container.remove();
        $(this.element).removeAttr('data-tc-id');
        $(this.element).removeData('tc-id');
    };

    TC_Instance.prototype.setOptions = function(options) {
        if (this.config === null) {
            this.default_options.ref_date = new Date();
            this.config = $.extend(true, {}, this.default_options);
        }
        $.extend(true, this.config, options);

        // Use window.top if use_top_frame is true
        if (this.config.use_top_frame) {
            useWindow = window.top;
        } else {
            useWindow = window;
        }
        updateUsedWindow();

        this.data.total_duration = this.config.total_duration;
        if (typeof this.data.total_duration === "string") {
            if (typeof secondsIn[this.data.total_duration] !== "undefined") {
                // If set to Years, Months, Days, Hours or Minutes, fetch the secondsIn value for that
                this.data.total_duration = secondsIn[this.data.total_duration];
            } else if (this.data.total_duration === "Auto") {
                // If set to auto, total_duration is the size of 1 unit, of the unit type bigger than the largest shown
                for (var i = 0; i < Object.keys(this.config.time).length; i++) {
                    var unit = Object.keys(this.config.time)[i];
                    if (this.config.time[unit].show) {
                        this.data.total_duration = secondsIn[nextUnits[unit]];
                        break;
                    }
                }
            } else {
                // If it's a string, but neither of the above, user screwed up.
                this.data.total_duration = secondsIn["Years"];
                console.error("Valid values for TimeCircles config.total_duration are either numeric, or (string) Years, Months, Days, Hours, Minutes, Auto");
            }
        }
    };

    TC_Instance.prototype.addListener = function(f, context, type) {
        if (typeof f !== "function")
            return;
        if (typeof type === "undefined")
            type = "visible";
        this.listeners[type].push({ func: f, scope: context });
    };

    TC_Instance.prototype.notifyListeners = function(unit, value, total, type) {
        for (var i = 0; i < this.listeners[type].length; i++) {
            var listener = this.listeners[type][i];
            listener.func.apply(listener.scope, [unit, value, total]);
        }
    };

    TC_Instance.prototype.default_options = {
        ref_date: new Date(),
        start: true,
        animation: "smooth",
        count_past_zero: true,
        circle_bg_color: "#60686F",
        use_background: true,
        fg_width: 0.1,
        bg_width: 1.2,
        text_size: 0.07,
        number_size: 0.28,
        total_duration: "Auto",
        direction: "Clockwise",
        use_top_frame: false,
        start_angle: 0,
        time: {
            Days: {
                show: true,
                text: "Days",
                color: "#FC6"
            },
            Hours: {
                show: true,
                text: "Hours",
                color: "#9CF"
            },
            Minutes: {
                show: true,
                text: "Minutes",
                color: "#BFB"
            },
            Seconds: {
                show: true,
                text: "Seconds",
                color: "#F99"
            }
        }
    };

    // Time circle class
    var TC_Class = function(elements, options) {
        this.elements = elements;
        this.options = options;
        this.foreach();
    };

    TC_Class.prototype.getInstance = function(element) {
        var instance;

        var cur_id = $(element).data("tc-id");
        if (typeof cur_id === "undefined") {
            cur_id = guid();
            $(element).attr("data-tc-id", cur_id);
        }
        if (typeof TC_Instance_List[cur_id] === "undefined") {
            var options = this.options;
            var element_options = $(element).data('options');
            if (typeof element_options === "string") {
                element_options = JSON.parse(element_options);
            }
            if (typeof element_options === "object") {
                options = $.extend(true, {}, this.options, element_options);
            }
            instance = new TC_Instance(element, options);
            TC_Instance_List[cur_id] = instance;
        } else {
            instance = TC_Instance_List[cur_id];
            if (typeof this.options !== "undefined") {
                instance.setOptions(this.options);
            }
        }
        return instance;
    };

    TC_Class.prototype.addTime = function(seconds_to_add) {
        this.foreach(function(instance) {
            instance.addTime(seconds_to_add);
        });
    };

    TC_Class.prototype.foreach = function(callback) {
        var _this = this;
        this.elements.each(function() {
            var instance = _this.getInstance(this);
            if (typeof callback === "function") {
                callback(instance);
            }
        });
        return this;
    };

    TC_Class.prototype.start = function() {
        this.foreach(function(instance) {
            instance.start();
        });
        return this;
    };

    TC_Class.prototype.stop = function() {
        this.foreach(function(instance) {
            instance.stop();
        });
        return this;
    };

    TC_Class.prototype.restart = function() {
        this.foreach(function(instance) {
            instance.restart();
        });
        return this;
    };

    TC_Class.prototype.rebuild = function() {
        this.foreach(function(instance) {
            instance.initialize(false);
        });
        return this;
    };

    TC_Class.prototype.getTime = function() {
        return this.getInstance(this.elements[0]).timeLeft();
    };

    TC_Class.prototype.addListener = function(f, type) {
        if (typeof type === "undefined")
            type = "visible";
        var _this = this;
        this.foreach(function(instance) {
            instance.addListener(f, _this.elements, type);
        });
        return this;
    };

    TC_Class.prototype.destroy = function() {
        this.foreach(function(instance) {
            instance.destroy();
        });
        return this;
    };

    TC_Class.prototype.end = function() {
        return this.elements;
    };

    $.fn.TimeCircles = function(options) {
        return new TC_Class(this, options);
    };
}(jQuery));

var isClosed = 0;



$("#CountDownTimer").TimeCircles({ time: { Days: { show: false }, Hours: { show: true } } }).addListener(
    function(unit, value, total) {
        if (total < 0) {
            $("#CountDownTimer").TimeCircles().stop();
            $("#confirmText").text("Your time is up. Click ok to submit your answers or click cancel to reload.");
            $("#btnCancel").show();
            $("#btnClose").hide();
            if (isClosed == 0) {
                var confirmResult = confirm("Your time is up. Click ok to submit your answers or click cancel to reload.");
                if (confirmResult) {
                    SubmitAnswers();
                } else {
                    var url = window.location.href;
                    window.location.href = url;
                }
            }
            isClosed = 1;
            //submitAnswers();
        }

    }
);

$(document).ready(function() {
    $(".optionItem input[type=radio]").change(function() {
        $(this).parent().parent().find(".optionItem").removeClass("active");
        $(this).parent().addClass("active");
    });
    $(".optionItem input[type=checkbox]").change(function() {
        //   $(this).parent().parent().find(".optionItem").removeClass("active");
        if ($(this).is(':checked')) {
            $(this).parent().addClass("active");
        } else {
            $(this).parent().removeClass("active");
        }
    });
});

function CancelSelection(id) {
    $("#QuestionItem-" + id).find(".optionItem").removeClass("active");
    $("#QuestionItem-" + id).find("input[type=radio]").prop('checked', false);
    $("#QuestionItem-" + id).find("input[type=checkbox]").attr('checked', false);;

}

function selectQuestion(id) {

    $(".QuestionItem").hide();
    $("#questionNo-" + (id)).html(id);
    $("#QuestionItem-" + (id)).show();
}

function ReviewLater(id) {
    var type = ($("#QuestionItem-" + (id)).attr("data-type"));
    $("#questionNo-" + (id)).addClass("ReviewedLaterClass");
    if (type == 'Multi Option') {
        var check = $("#QuestionItem-" + (id)).find("input[type='checkbox'][name='rdOption-" + (id) + "']:checked").length;
        if (check > 0) {
            $("#questionNo-" + (id)).removeClass("selectedClass");
            $("#questionNo-" + (id)).removeClass("ReviewedLaterClass");
            $("#questionNo-" + (id)).addClass("ReviewedLaterAnsweredClass");

            $("#questionNo-" + (id)).html(id + '<i class="fa fa-check" style="position: absolute;top: 0;"></i>');
        }

    }
    if (type == 'Single Option') {
        var check = $("#QuestionItem-" + (id)).find("input[type='radio'][name='rdOption-" + (id) + "']:checked").length;
        if (check > 0) {
            $("#questionNo-" + (id)).removeClass("selectedClass");
            $("#questionNo-" + (id)).removeClass("ReviewedLaterClass");
            $("#questionNo-" + (id)).addClass("ReviewedLaterAnsweredClass");
            $("#questionNo-" + (id)).html(id + '<i class="fa fa-check" style="position: absolute;top: 0;"></i>');
        }

    }



    $(".QuestionItem").hide();
    $("#QuestionItem-" + (id + 1)).show();
}

function goNext(id) {


    var type = ($("#QuestionItem-" + (id - 1)).attr("data-type"));
    if (type == 'Multi Option') {
        var check = $("#QuestionItem-" + (id - 1)).find("input[type='checkbox'][name='rdOption-" + (id - 1) + "']:checked").length;
        if (check > 0) {
            $("#questionNo-" + (id - 1)).removeClass("selectedClass");
            $("#questionNo-" + (id - 1)).removeClass("ReviewedLaterAnsweredClass");
            $("#questionNo-" + (id - 1)).removeClass("ReviewedLaterClass");
            $("#questionNo-" + (id - 1)).addClass("answeredClass");
            $("#questionNo-" + (id - 1)).html((id - 1));
        }

    }
    if (type == 'Single Option') {
        var check = $("#QuestionItem-" + (id - 1)).find("input[type='radio'][name='rdOption-" + (id - 1) + "']:checked").length;
        if (check > 0) {
            $("#questionNo-" + (id - 1)).removeClass("selectedClass");
            $("#questionNo-" + (id - 1)).removeClass("ReviewedLaterAnsweredClass");
            $("#questionNo-" + (id - 1)).removeClass("ReviewedLaterClass");
            $("#questionNo-" + (id - 1)).addClass("answeredClass");
            $("#questionNo-" + (id - 1)).html((id - 1));
        }

    }

    $("#questionNo-" + (id)).addClass("selectedClass");
   
    if ((id-1) == $(".rightQuestion").length) {
        var confirmResult = confirm("Are you sure want to submit your answers?");
        if (confirmResult) {
            $("#CountDownTimer").TimeCircles().stop();
            $("#btnCancel").hide();
            $("#btnClose").show();
              SubmitAnswers();
        }

    } else {
        $(".QuestionItem").hide();
        $("#QuestionItem-" + id).show();
    }


}

//function goNext(id)
//{
//      $("#QuestionItem-"+(id-1)).hide();
//  $("#QuestionItem-"+id).show();
//  }
function goBack(id) {
    $("#QuestionItem-" + (id + 1)).hide();
    $("#QuestionItem-" + id).show();
}

function finish() {
    $("#CountDownTimer").TimeCircles().stop();
    $("#btnCancel").hide();
    $("#btnClose").show();
    if (isClosed == 0) {
        var confirmResult = confirm("Are you sure want to submit your answers?");
        if (confirmResult) {
            SubmitAnswers()
        } else {
            var url = window.location.href;
            window.location.href = url;
        }
    }
    isClosed = 1;
}

function SubmitAnswers() {
    $(".btn-finish").hide();
    $(".Loading").show();
    if ($(".QuestionItem:last-child").attr("data-type") == "Single Option") {
        console.log($(".QuestionItem:last-child").find("input[type='radio']:checked").length);
        if ($(".QuestionItem:last-child").find("input[type='radio']:checked").length > 0) {

            var id = $(".QuestionItem:last-child").attr("id").split("-")[1];
            $("#questionNo-" + (id)).removeClass("selectedClass");
            $("#questionNo-" + (id)).addClass("answeredClass");
        } else {
            $("#questionNo-" + (id)).removeClass("selectedClass");

        }
    }
    if ($(".QuestionItem:last-child").attr("data-type") == "Multi Option") {
        console.log($(".QuestionItem:last-child").find("input[type='checkbox']:checked").length);
        if ($(".QuestionItem:last-child").find("input[type='checkbox']:checked").length > 0) {
            var id = $(".QuestionItem:last-child").attr("id").split("-")[1];
            $("#questionNo-" + (id)).removeClass("selectedClass");
            $("#questionNo-" + (id)).addClass("answeredClass");
        } else {
            $("#questionNo-" + (id)).removeClass("selectedClass");

        }
    }
    $(".rightQuestion").css("pointer-events", "none");
    var UserCorrectAnsmers = 0;
    var WrongAnsmers = 0;
    var totalMarks = 0;
    var totalSecuredMarks = 0;
    var AttendAnsmers = 0;
    var TestResult = {};
    var QuestionAnswers = [];
    var result = "<table class='table table-bordered table-striped'><tbody>";
    $(".QuestionItem").each(function() {
        result += "<tr><td style='font-size: 14px;line-height: 25px;'>" + $(this).find(".QuestionTitle").html() + "</td></tr><tr><td>";
        var QuestionAnswer = {};
        var ItemId = $(this).attr("id");
        QuestionAnswer.Title = $(this).find(".QuestionTitle").html();
        QuestionAnswer.name = $(this).attr("data-name");
        var QuestionOptions = [];
        var CorrectAnswer = [];
        var UserAnswer = [];
        if ($(this).attr("data-type") == "Single Option") {
            if ($(this).find("input[type='radio']:checked").length > 0) {

                UserAnswer.push($(this).find("input[type='radio']:checked").val());
                AttendAnsmers += 1;
            }

        }
        if ($(this).attr("data-type") == "Multi Option") {
            if ($(this).find("input[type='checkbox']:checked").length > 0) {
                $(this).find(".options input[type='checkbox']").each(function() {
                    if ($(this).is(':checked')) {
                        UserAnswer.push($(this).val());
                    }
                });
                AttendAnsmers += 1;
            }

        }
        if ($(this).attr("data-type") == "Single Option") {
            $(this).find(".options input[type='radio']").each(function() {
                QuestionOptions.push($(this).val());
                var iscorrect = "";
                if ($(this).attr("data-correct") == "1") {
                    CorrectAnswer.push($(this).val());
                    result += '<p style="margin-bottom: 10px; margin-left: 15px;"><i class="fa fa-circle" aria-hidden="true" style="margin-right:10px;color: #747474;"></i>' + $(this).val() + '<i class="fa fa-check-circle" aria-hidden="true" style="margin-left:10px;color: #4cae4c;font-size: 20px;"></i></p>';

                } else {
                    if ($(this).is(':checked')) {
                        result += '<p style="margin-bottom: 10px; margin-left: 15px;"><i class="fa fa-circle" aria-hidden="true" style="margin-right:10px;color: #747474;"></i>' + $(this).val() + '<i class="fa fa-times-circle" aria-hidden="true" style="margin-left:10px;color: #d43f3a;font-size: 20px;"></i></p>';
                    } else {
                        result += '<p style="margin-bottom: 10px; margin-left: 15px;"><i class="fa fa-circle" aria-hidden="true" style="margin-right:10px;color: #747474;"></i>' + $(this).val() + '</p>';
                    }

                }
            });
        } else {
            $(this).find(".options input[type='checkbox']").each(function() {
                QuestionOptions.push($(this).val());
                var iscorrect = "";
                if ($(this).attr("data-correct") == "1") {
                    CorrectAnswer.push($(this).val());
                    result += '<p style="margin-bottom: 10px; margin-left: 15px;"><i class="fa fa-circle" aria-hidden="true" style="margin-right:10px;color: #747474;"></i>' + $(this).val() + '<i class="fa fa-check-circle" aria-hidden="true" style="margin-left:10px;color: #4cae4c;font-size: 20px;"></i></p>';

                } else {
                    if ($(this).is(':checked')) {
                        result += '<p style="margin-bottom: 10px; margin-left: 15px;"><i class="fa fa-circle" aria-hidden="true" style="margin-right:10px;color: #747474;"></i>' + $(this).val() + '<i class="fa fa-times-circle" aria-hidden="true" style="margin-left:10px;color: #d43f3a;font-size: 20px;"></i></p>';
                    } else {
                        result += '<p style="margin-bottom: 10px; margin-left: 15px;"><i class="fa fa-circle" aria-hidden="true" style="margin-right:10px;color: #747474;"></i>' + $(this).val() + '</p>';
                    }

                }
            });
        }
        var is_same = UserAnswer.length == CorrectAnswer.length && UserAnswer.every(function(element, index) {
            return element === CorrectAnswer[index];
        });
        if (is_same) {
            UserCorrectAnsmers += 1;
            totalSecuredMarks += parseInt($(this).attr("secured-marks"));
        } else {
            if ($(this).attr("data-type") == "Single Option") {
                if ($(this).find("input[type='radio']:checked").length > 0) {
                    WrongAnsmers += 1;
                }
            } else {
                if ($(this).find("input[type='checkbox']:checked").length > 0) {
                    WrongAnsmers += 1;
                }
            }
        }
        console.log(UserAnswer);
        console.log(CorrectAnswer);
        totalMarks += parseInt($(this).attr("secured-marks"));
        QuestionAnswer.CorrectAnswer = CorrectAnswer;
        QuestionAnswer.IsUserAnswerCorrect = is_same;
        QuestionAnswer.UserAnswer = UserAnswer;
        QuestionAnswer.QuestionOptions = QuestionOptions;
        QuestionAnswers.push(QuestionAnswer);
    });
    TestResult.QuestionAnswers = QuestionAnswers;
    TestResult.AttendAnsmers = AttendAnsmers;
    TestResult.SecuredMarks = totalSecuredMarks;
    TestResult.TotalMarks = totalMarks-1;
    TestResult.WrongAnsmers = WrongAnsmers;
    TestResult.UserCorrectAnsmers = UserCorrectAnsmers;
    var headerresult = '<div class="resultHeader"><h3 class="resultHeaderTitle">Your Result</h3>';
    headerresult += '<div class="col-md-4 col-xs-12 headerTitle">Total Questions :' + $(".QuestionItem").length + '</div>';
    headerresult += '<div class="col-md-4 col-xs-12 headerTitle">Attended Questions :' + AttendAnsmers + '</div>';
    headerresult += '<div class="col-md-4 col-xs-12 headerTitle">Correct Answers :' + UserCorrectAnsmers + '</div>';
    headerresult += '<div class="col-md-4 col-xs-12 headerTitle">Wrong Answers :' + WrongAnsmers + '</div>';
    headerresult += '<div class="col-md-4 col-xs-12 headerTitle">Total Marks :' + totalMarks + '</div>';
    headerresult += '<div class="col-md-4 col-xs-12 headerTitle">Secured Marks :' + totalSecuredMarks + '</div></div>';
   
    var exam_result_questions = [];
    for (var i = 0; i < QuestionAnswers.length; i++) {
        var exam_result_question = {};
        exam_result_question.questionid = QuestionAnswers[i].name;
        exam_result_question.question = QuestionAnswers[i].Title;
        exam_result_question.correct_answer = QuestionAnswers[i].CorrectAnswer.toString();
        exam_result_question.useranswer = QuestionAnswers[i].UserAnswer.toString();
        exam_result_question.is_useranswer_correct = QuestionAnswers[i].IsUserAnswerCorrect;
        exam_result_questions.push(exam_result_question);
    }
    console.log(TestResult);
    var endDate= new Date();
    frappe.call({
        method: "frappe.client.insert",
        args: {
            doc: {
                "doctype": "Exam Result",
                "date_submitted":endDate.getFullYear()+"-"+pad((parseInt(endDate.getMonth())+1),2)+"-"+endDate.getDate(),
                "exam_start_date":startTime,
                "exam_end_date":endDate.getHours()+":"+endDate.getMinutes()+":"+endDate.getSeconds(),
                "user": $("#UserInfoId").val(),
                "correct_answers": TestResult.UserCorrectAnsmers,
                "wrong_answers": TestResult.WrongAnsmers,
                "attended": TestResult.AttendAnsmers,
                "total_marks": TestResult.TotalMarks,
                "secured__marks": TestResult.SecuredMarks,
                // "question_and_answers": TestResult.QuestionAnswers,
                "exam_id":$("#ExamId").val()

            }

        },
        callback: function(Responseresult) {
          
           var resultName=Responseresult.message.name;
           console.log(resultName);
            var valuesDocss=[];
            for(var i=0;i<TestResult.QuestionAnswers.length;i++)
            {
               

                var isCorrect=0;
                if(TestResult.QuestionAnswers[i].IsUserAnswerCorrect)
                {
                isCorrect=1;
                }
                var valueObj={"doctype":"User Answer",
               "parent":resultName,
               "user_answer":TestResult.QuestionAnswers[i].UserAnswer.toString(),
               "question":TestResult.QuestionAnswers[i].Title.toString(),
               "is_user_answer_correct":isCorrect,
               "parenttype":"Exam Result",
               "correct_answer":TestResult.QuestionAnswers[i].CorrectAnswer.toString(),
               "question_id":TestResult.QuestionAnswers[i].name,
               "parentfield":"user_answer"};
               valuesDocss.push(valueObj);
           
        }
console.log(valuesDocss);
var percent = parseFloat(totalSecuredMarks / totalMarks * 100).toFixed(2);; 

var scholarship = '<div class="resultHeader" id ="scho" ><h3 class="resultHeaderTitle">Available Discounts</h3><div class="col-md-3 col-xs-12 headerTitle">Scholarship Name :2</div><div class="col-md-3 col-xs-12 headerTitle" id = "dis_per">Discount Percentage :</div>\
    <div class="col-md-3 col-xs-12 headerTitle">Secured Percentage :'  +percent+  '%</div>\
    <a href="student-applicant"><button type="button" id="application" class="col-md-3 col-xs-12 headerTitle btn">Apply Using Scholarship</button></a></div>';

frappe.call({
        method: "frappe.client.insert_many",
        args: {
            docs: valuesDocss

        },
        callback: function(r) {
            $(".Loading").hide();
             if($("#IsPublicResult").val()=="Publish Immediately")
    {
        if (schavailable(percent)) 
            {
                $("#MainContent").html(scholarship + headerresult + result);
            }
        else{
                $("#MainContent").html(headerresult + result);
            }
    }
    else
    {
    $("#MainContent").html("<span class='resultSpan'>Thank you for attending exam.You will get notification regarding result.</span>");

            }
    }
        });
}
    });
   
}

function pad(str, max) {
                 str = str.toString();
                 return str.length < max ? pad("0" + str, max) : str;
             }

function schavailable(percent) {
    var sch = $("#scholarship").val();
    if (sch != "None") 
    { 
        frappe.call
        ({
                "method": "frappe.client.get",
                args: {
                    doctype: "Scholarship",
                    name: sch
                },
                callback: function(r) 
                {
                    console.log(r.message)

                    for (var i = 0; i<r.message.offer.length; i++) 
                    {
                        var p = parseFloat(r.message.offer[i].from_mark)+"="+percent+"="+parseFloat(r.message.offer[i].to_mark)
                        console.log(p)
                        if ((percent <= parseFloat(r.message.offer[i].to_mark)) && (percent >= parseFloat(r.message.offer[i].from_mark))) 
                        {   
                            
                            $("#dis_per").html("Discount Percentage :"+r.message.offer[i].scholarship);

                                frappe.call({
                                    method: "frappe.client.set_value",
                                    args: {
                                        doctype: "User",
                                        name: frappe.user_id,
                                        fieldname: "scholarship_discount_percent",
                                        value: r.message.offer[i].scholarship,
                                    },
                                    freeze: true,
                                    callback: (r) => {
                                        console.log(r.message)
                                    }
                                });

                            if (r.message.offer[i].scholarship == 0) 
                                {
                                $("#scho").toggle();
                                $("#MainContent").prepend('<a href="student-applicant"><button type="button" id="freeapplication" class="btn">Apply</button></a>');

                                } 

                        }
                    }
                    
                }
        });
        return true
    }
    else
    {
        return false
    }
}
</script>

{% endblock %}